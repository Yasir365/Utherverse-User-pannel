<!-- <article
  class="animation-class"
  style="background: #c1c1b7"
  *ngIf="warningToastr"
>
  <div class="container d-flex justify-content-between">
    <div class="d-flex gap-2 align-items-end text-black p-4">
      <i
        class="fa fa-warning"
        style="font-size: 30px; color: rgb(255, 72, 0)"
      ></i>
      <p>
        <b>Warning:</b> Staking is currently enabled only on the test/dev
        network, so please avoid staking.
      </p>
    </div>

    <button
      type="button"
      class="close bg-transparent border-0"
      aria-label="Close"
      (click)="closeWarning()"
    >
      <span aria-hidden="true" style="font-size: 2rem">&times;</span>
    </button>
  </div>
</article> -->

<nav class="container-fluid">
  <div class="d-flex justify-content-start">
    <img
      src="../../../assets/images/New_Registered_Logo_with_Tag.png"
      alt="Image not preview"
      class="logo"
    />
  </div>
</nav>

<main
  class="container-fluid bg-primary-dark p-5 mt-4"
  style="border-radius: 7px"
>
  <div class="d-flex flex-column gap-2">
    <div class="d-flex flex-wrap-reverse gap-2 justify-content-between">
      <p class="d-flex flex-column flex-wrap gap-2">
        <span style="font-family: 'mont-bold'; color: whitesmoke">
          Wallet Address:</span
        >
        <span class="d-flex align-items-center">
          <p
            style="text-decoration: none; color: whitesmoke"
            class="text-truncate wallet-address__truncate"
          >
            {{ token ? user_sol_wallet : "Connect Your Wallet" }}
          </p>
          <i
            class="copy-button fa-solid fa-copy text-center ml-2 copy_icon"
            style="margin-left: 10px; cursor: pointer; color: white"
            (click)="copiedAddress(user_sol_wallet)"
            *ngIf="user_sol_wallet && token"
          ></i>
        </span>
      </p>

      <button
        type="button"
        class="bg-gradient-pink1 btn text-white rounded-pill px-4 py-2"
        style="
          width: fit-content;
          height: fit-content;
          margin-right: 10px;
          border-radius: 4px !important;
        "
        [disabled]="walletConnectLoader"
        (click)="toggleFunction()"
      >
        {{ !token ? "Connect Wallet" : "Disconnect Wallet" }}
      </button>
    </div>

    <hr />

    <div class="d-flex justify-content-center text-white">
      <div
        class="col-xl-4 col-md-10 col-sm-11 p-4"
        style="background-color: #030614; border-radius: 4px"
      >
        <p class="text-center" style="font-size: 24px">Stake your UTHX Token</p>

        <form
          [formGroup]="stakingForm"
          (ngSubmit)="createStake()"
          class="d-flex flex-column gap-4"
        >
          <div class="d-flex flex-column gap-2">
            <label for="amount">Token Amount</label>
            <input
              type="number"
              id="amount"
              class="form-control p-2"
              min="1"
              placeholder="Enter Amount"
              formControlName="amount"
              (input)="checkAvailableBanace($event)"
              (keypress)="onlyAllowNumbers($event)"
            />
          </div>

          <div class="d-flex flex-column gap-2">
            <label for="poolInfo">Contract Type</label>
            <p
              class="form-control p-2 text-black-50"
              style="cursor: not-allowed"
              *ngIf="!user_sol_wallet"
            >
              Connect Your Wallet First
            </p>
            <select
              class="form-select"
              aria-label="Default select example"
              id="poolInfo"
              *ngIf="user_sol_wallet"
              formControlName="poolInfo"
              (change)="selectedPoolId($event)"
            >
              <option value="" selected disabled>Select Contract Type</option>

              <option
                *ngFor="let data of poolIdList; let i = index"
                [value]="data.pool_id"
              >
                <!-- {{ "Pool-" + (i + 1) + " for " + getLockTime(data) }} -->

                {{ data?.pool_name }}
              </option>
            </select>
          </div>
          <!-- 
          <div class="d-flex flex-column gap-2">
            <label class="d-flex gap-3">
              <input
                type="checkbox"
                (change)="autoStake($event)"
                class="form-check-input"
                formControlName="autostake"
              />
              <span>Auto Stake</span>
            </label>
          </div> -->

          <div class="d-flex flex-column gap-2 text-white">
            <p style="font-size: 1rem">Available UTHX tokens: {{ balance }}</p>
          </div>

          <div class="d-flex justify-content-end mt-4">
            <button
              type="submit"
              class="bg-gradient-pink1 btn text-white rounded-pill px-4 py-2"
              style="
                width: fit-content;
                height: fit-content;
                margin-right: 10px;
                border-radius: 4px !important;
              "
              [disabled]="loader"
            >
              Stake
              <div
                class="spinner-border"
                role="status"
                *ngIf="loader"
                style="width: 1.5rem; height: 1.5rem"
              >
                <span class="sr-only"></span>
              </div>
            </button>
          </div>
        </form>
      </div>
    </div>

    <hr />

    <div class="d-flex justify-content-center align-items-center mt-4">
      <div class="col-xl-5 col-md-8 col-sm-11 p-3">
        <p class="text-white text-break mail-title text-center">
          <!-- Need added in a nice professional way to the page: <br /> -->

          If you have any questions or need help please reach out to
          <a href="mailto:businessdevelopment@utherverse.io">{{
            emailAddress
          }}</a>
          and we will be happy to assist you.
        </p>
      </div>
    </div>
  </div>
</main>

<div class="container-fluid table__container p-0">
  <h3 class="text-white mt-3 m-3">Staking History</h3>
  <table class="table listings__table listings__table--dark rounded">
    <thead>
      <th scope="col">#</th>
      <th scope="col">Transaction Hash</th>
      <th scope="col">wallet Address</th>
      <th scope="col">Staked Amount</th>
      <th scope="col">Contract Type</th>
      <!-- <th scope="col">Auto Stake</th> -->
      <th scope="col">Status</th>
      <th class="text-center">Actions</th>
    </thead>
    <tbody>
      <ng-container
        *ngIf="user_stake_list?.length > 0 && token && user_sol_wallet"
      >
        <ng-container
          *ngFor="
            let data of user_stake_list
              | paginate
                : {
                    id: 'staking',
                    itemsPerPage: itemsPerPage,
                    currentPage: currentPage,
                    totalItems: totalItems
                  };
            let i = index
          "
        >
          <tr>
            <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
            <td>
              <span title="{{ data?.hashAddress }}"
                >{{ data?.hashAddress?.slice(0, 20) }}...
                <i
                  class="fa fa-copy"
                  *ngIf="data?.hashAddress"
                  (click)="copiedAddress(data?.hashAddress)"
                ></i
              ></span>
            </td>
            <td>
              <span title="{{ data?.signer }}"
                >{{ data?.signer?.slice(0, 20) }}...
              </span>
            </td>

            <td>{{ data?.amount }}</td>
            <td>{{ data?.poolData[0]?.pool_name }}</td>
            <!-- <td><span class="badge" ngClass="{{ data?.status ? 'bg-success' : 'bg-primary' }}"> {{ data?.autostake }} </span></td> -->
            <td>
              <span
                class="badge"
                ngClass="{{
                  data?.status == 'pending' ? 'bg-warning' : 'bg-success'
                }}"
                >{{ data?.status | titlecase }}
              </span>
            </td>

            <td class="d-flex justify-content-center">
              <button
                class="btn btn-sm btn-primary d-flex align-items-center"
                data-bs-toggle="modal"
                data-bs-target="#stakeingDetailModal"
                (click)="openStackDetail(data)"
                style="padding: 6px 8px"
              >
                <i
                  class="fa-solid fa-circle-info"
                  style="font-size: 1.2rem"
                ></i>
              </button>

              <button class="btn btn-primary ms-1" (click)="claimStake(data)">
                <!-- *ngIf=" !data.autoStake && checkValidTime(data?.stackDetails, 'claim')" -->
                Claim
              </button>
              <button
                class="btn btn-primary ms-1"
                (click)="deStakeConfirm(data)"
              >
                <!-- *ngIf="checkValidTime(data.stackDetails, 'destake')" -->
                Destake
              </button>
              <button class="btn btn-primary ms-1" (click)="restakeStake(data)">
                <!-- *ngIf="!data.autoStake && checkValidTime(data.stackDetails, 'claim')" -->
                Restake
              </button>
            </td>
          </tr>
        </ng-container>
      </ng-container>
      <ng-container
        *ngIf="user_stake_list?.length === 0 || !token || !user_sol_wallet"
      >
        <tr>
          <td colspan="13" class="text-center">No Records</td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <pagination-controls
    class="d-flex justify-content-end align-items-end w-100"
    id="staking"
    (pageChange)="onPageChange($event)"
  >
  </pagination-controls>
</div>

<footer>
  <div class="col-9 mx-auto d-flex justify-content-center py-2 mt-5">
    <div class="col-12">
      <div class="d-flex justify-content-center gap-2 text-white mt-3">
        <button class="privacy_policy" (click)="downloadPdfFile()">
          Audit by SpyWolf
        </button>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center align-items-center">
    <p class="text-white">
      <small>© 2024 Utherverse Inc.</small>
    </p>
  </div>
</footer>

<div
  class="modal fade"
  id="stakeingDetailModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="stakeingDetailModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content bg-primary-dark text-dark">
      <div class="modal-header">
        <h5 class="modal-title text-white">
          Stake Details
          <span *ngIf="selectedStake && selectedStake?.poolData.length > 0">
            ({{ checkPoolInfo() }})
          </span>
        </h5>
        <button
          type="button"
          class="close close-btn"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="bg-primary-dark text-white">
          <div class="row" *ngIf="selectedStake">
            <div class="col-6 item">
              <strong>Staked Amount:</strong>
              <span class="value">{{
                calculateStakedAmount(selectedStake?.stackDetails.stakedAmount)
              }}</span>
            </div>
            <div class="col-6 item">
              <strong>Claim Cycles Passed:</strong>
              <span class="value">{{
                selectedStake?.stackDetails.claimCyclesPassed
              }}</span>
            </div>
            <!-- <div class="col-6 item">
              <strong>Autostake:</strong>
              <span class="value">{{
                selectedStake?.stackDetails.autostake
              }}</span>
            </div> -->
            <div class="col-6 item">
              <strong>Total Claim Cycles:</strong>
              <span class="value">{{
                selectedStake?.stackDetails.totalClaimCycles
              }}</span>
            </div>
            <div class="col-6 item">
              <strong>Unclaimed Rewards:</strong>
              <span class="value">{{
                calculateStakedAmount(
                  selectedStake?.stackDetails.unclaimedRewards
                )
              }}</span>
            </div>
            <div class="col-6 item">
              <strong>Deposit Time:</strong>
              <span class="value">{{
                formatTimestamp(selectedStake?.stackDetails.depositTimestamp)
              }}</span>
            </div>
            <div class="col-6 item">
              <strong>Last Interaction Time:</strong>
              <span class="value">{{
                formatSlotTime(selectedStake?.stackDetails, "LIT")
              }}</span>
            </div>
            <div class="col-6 item">
              <strong>Next Claim Time:</strong>
              <span class="value"
                >{{ formatSlotTime(selectedStake?.stackDetails, "NCT") }}
              </span>
            </div>
            <div class="col-6 item">
              <strong>Total Claimed:</strong>
              <span class="value">{{
                calculateStakedAmount(selectedStake?.stackDetails.totalClaimed)
              }}</span>
            </div>
            <div class="col-6 item">
              <strong>End Time:</strong>
              <span class="value">{{
                formatSlotTime(selectedStake?.stackDetails, "EDT")
              }}</span>
            </div>
          </div>

          <table
            class="table listings__table listings__table--dark rounded"
            *ngIf="selectedStake && selectedStake.sub_stake"
          >
            <thead>
              <th scope="col">#</th>
              <th scope="col">Transaction Hash</th>
              <th scope="col">wallet Address</th>
              <th scope="col">Type</th>
              <th scope="col">Status</th>
              <th scope="col">Created Date</th>
            </thead>
            <tbody>
              <ng-container>
                <ng-container
                  *ngFor="let data of selectedStake.sub_stake; let i = index"
                >
                  <tr *ngIf="data.status === 'confirmed'">
                    <td>{{ i + 1 }}</td>
                    <td>
                      <span title="{{ data?.hashAddress }}"
                        >{{ data?.hashAddress?.slice(0, 20) }}...</span
                      >
                    </td>
                    <td>
                      <span title="{{ data?.signer }}"
                        >{{ data?.signer?.slice(0, 20) }}...
                      </span>
                    </td>
                    <td>{{ data?.type }}</td>
                    <td>
                      <span
                        class="badge"
                        ngClass="{{
                          data?.status == 'pending'
                            ? 'bg-warning'
                            : 'bg-success'
                        }}"
                        >{{ data?.status | titlecase }}
                      </span>
                    </td>
                    <td>
                      {{ data?.createdAt | date : "YYYY MM, dd hh:mm a" }}
                    </td>
                  </tr>
                </ng-container>

                <tr *ngIf="selectedStake.sub_stake.length === 0">
                  <td colspan="6" class="text-center">No Records</td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
